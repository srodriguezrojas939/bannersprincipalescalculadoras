<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora Zen – WebM Correcto</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
:root {
    --calc-body:#f0f0f0;
    --calc-border:#d0d0d0;
    --btn-face:#a0a0a0;
    --btn-border:#7a7a7a;
}

body{
    background:#e5e5e5;
    font-family:system-ui;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:30px;
}

.calculator{
    width:360px;
    background:var(--calc-body);
    border-radius:55px;
    padding:30px;
    border:2px solid var(--calc-border);
    border-bottom:12px solid var(--calc-border);
    display:flex;
    flex-direction:column;
    gap:20px;
}

.screen-container{
    background:#d8d8d8;
    padding:3px;
    border-radius:34px;
}

.screen{
    background:#fff;
    height:140px;
    border-radius:31px;
    display:flex;
    align-items:center;
    justify-content:center;
}

.keypad{
    background:#e2e2e2;
    border-radius:45px;
    padding:20px;
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:15px;
}

@keyframes solidPress{
    0%,20%,100%{transform:translateY(0)}
    50%{transform:translateY(6px);background:#888}
}

.btn{
    background:var(--btn-face);
    aspect-ratio:1/1;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:42px;
    font-weight:bold;
    border:2px solid var(--btn-border);
    border-bottom:8px solid var(--btn-border);
    animation:solidPress 4s infinite ease-in-out;
}

.btn-equal{
    grid-column:3;
    grid-row:1/span 2;
    aspect-ratio:auto;
    border-radius:100px;
    font-size:55px;
}

.btn:nth-child(1){animation-delay:0s}
.btn:nth-child(2){animation-delay:1.5s}
.btn:nth-child(3){animation-delay:3s}
.btn:nth-child(4){animation-delay:.7s}
.btn:nth-child(5){animation-delay:2.2s}

.ui{
    margin-top:20px;
    background:white;
    padding:25px;
    border-radius:25px;
    width:420px;
}

textarea{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:1px solid #ddd;
    margin-bottom:10px;
}

button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:12px;
    background:#333;
    color:white;
    font-weight:bold;
    cursor:pointer;
}
</style>
</head>

<body>

<div id="capture-area">
    <div class="calculator">
        <div class="screen-container">
            <div class="screen">
                <div id="latex-output"></div>
            </div>
        </div>
        <div class="keypad">
            <div class="btn">+</div>
            <div class="btn">-</div>
            <div class="btn btn-equal">=</div>
            <div class="btn">×</div>
            <div class="btn">÷</div>
        </div>
    </div>
</div>

<div class="ui">
    <textarea id="formula">E = mc^2</textarea>
    <button onclick="exportWebM()">Descargar WebM (20s)</button>
    <p id="status"></p>
</div>

<script>
const formula = document.getElementById('formula');
const output = document.getElementById('latex-output');
const status = document.getElementById('status');

function render(){
    katex.render(formula.value, output, {throwOnError:false,displayMode:true});
}
formula.addEventListener('input',render);
render();

async function exportWebM(){
    status.innerText="Grabando WebM…";

    const area = document.getElementById('capture-area');
    const rect = area.getBoundingClientRect();

    const canvas = document.createElement('canvas');
    canvas.width = rect.width;
    canvas.height = rect.height;
    const ctx = canvas.getContext('2d');

    const stream = canvas.captureStream(30);
    const recorder = new MediaRecorder(stream,{
        mimeType:'video/webm;codecs=vp9',
        videoBitsPerSecond:4_000_000
    });

    const chunks=[];
    recorder.ondataavailable=e=>chunks.push(e.data);
    recorder.onstop=()=>{
        const blob=new Blob(chunks,{type:'video/webm'});
        const a=document.createElement('a');
        a.href=URL.createObjectURL(blob);
        a.download='calculadora-zen.webm';
        a.click();
        status.innerText="Listo ✔";
    };

    recorder.start();

    let running=true;
    async function draw(){
        if(!running)return;
        const snap=await html2canvas(area,{backgroundColor:null,scale:1});
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(snap,0,0);
        requestAnimationFrame(draw);
    }
    draw();

    setTimeout(()=>{
        running=false;
        recorder.stop();
    },20000);
}
</script>

</body>
</html>
